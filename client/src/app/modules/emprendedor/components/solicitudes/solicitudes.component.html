<!-- <div class="solicitud-container"> -->
<!-- Vista de Carga -->
<div *ngIf="cargando" class="loading-container">
  <div class="spinner"></div>
  <p>Cargando solicitudes...</p>
</div>

<!-- Vista de Solicitudes Existentes -->
<div class="w-full">
  <div *ngIf="!cargando && tieneSolicitudes" class="w-full px-4 py-10 mx-auto max-w-7xl">

    <div class="space-y-6">
      <div *ngFor="let solicitud of solicitudes"
        class="bg-white rounded-2xl shadow-md hover:shadow-xl transition-all overflow-hidden border border-cyan-200">

        <!-- Header -->
        <div class="p-6 flex items-center justify-between bg-gradient-to-r from-cyan-400 to-cyan-600 text-white">
          <div class="flex-1">
            <h3 class="text-xl font-extrabold tracking-wide flex items-center gap-2">
              <i class="bi bi-building-fill"></i>
              {{ solicitud.nombre_negocio.toUpperCase() }}
            </h3>

            <span class="inline-flex items-center gap-1 mt-2 px-3 py-1 rounded-full text-xs font-semibold"
              [ngClass]="getEstadoClass(solicitud.estado)">
              <i class="bi bi-flag-fill"></i> {{ solicitud.estado.toUpperCase() }}
            </span>
          </div>

          <div class="flex-shrink-0">
            <span class="px-4 py-2 rounded-full text-xs font-bold flex items-center gap-2 shadow-md"
              [ngClass]="getRiesgoClass(solicitud.calificacion_riesgo)">
              <i class="bi bi-exclamation-triangle-fill"></i>
              {{ solicitud.calificacion_riesgo.toUpperCase() }} RIESGO
            </span>
          </div>
        </div>

        <!-- Body -->
        <div class="p-6">

          <!-- Grid #1 -->
          <div class="grid grid-cols-2 sm:grid-cols-4 gap-6 mb-8">
            <div>
              <span class="text-xs font-semibold text-gray-600 uppercase">Monto Solicitado</span>
              <div class="flex items-center gap-2 mt-1 text-lg font-bold text-amber-600">
                <i class="bi bi-cash-stack"></i>
                {{ formatearMoneda(solicitud.monto_solicitado) }}
              </div>
            </div>

            <div>
              <span class="text-xs font-semibold text-gray-600 uppercase">Plazo</span>
              <div class="flex items-center gap-2 mt-1 text-lg font-bold text-gray-800">
                <i class="bi bi-clock-history"></i>
                {{ solicitud.plazo_meses }} meses
              </div>
            </div>

            <div>
              <span class="text-xs font-semibold text-gray-600 uppercase">Utilidad Neta</span>
              <div class="flex items-center gap-2 mt-1 text-lg font-bold text-gray-800">
                <i class="bi bi-graph-up"></i>
                {{ formatearMoneda(solicitud.utilidad_neta) }}
              </div>
            </div>

            <div>
              <span class="text-xs font-semibold text-gray-600 uppercase">Ratio Cuota/Utilidad</span>
              <div class="flex items-center gap-2 mt-1 text-lg font-bold text-gray-800">
                <i class="bi bi-percent"></i>
                {{ solicitud.ratio_cuota_utilidad | number:'1.2-2' }}
              </div>
            </div>
          </div>

          <!-- Divider -->
          <div class="border-t border-gray-200 my-6"></div>

          <!-- Grid #2 -->
          <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <div>
              <h4 class="text-xs font-semibold text-gray-700 uppercase mb-2">Motivo del Préstamo</h4>
              <p class="text-sm text-gray-700 line-clamp-2">{{ solicitud.motivo_prestamo }}</p>
            </div>

            <div *ngIf="solicitud.motivo_decision">
              <h4 class="text-xs font-semibold text-gray-700 uppercase mb-2">Motivo de la Decisión</h4>
              <p class="text-sm text-gray-700 line-clamp-2">{{ solicitud.motivo_decision }}</p>
            </div>

            <div>
              <h4 class="text-xs font-semibold text-gray-700 uppercase mb-2">Observaciones del Analista</h4>
              <p [ngClass]="{
                  'text-sm text-gray-700 line-clamp-2': solicitud.observaciones_analista,
                  'text-sm text-gray-400 italic': !solicitud.observaciones_analista
                }">
                {{ solicitud.observaciones_analista || 'Aún no disponible' }}
              </p>
            </div>
          </div>

          <!-- Divider -->
          <div class="border-t border-gray-200 my-6"></div>

          <!-- Grid #3 – Dates -->
          <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
            <div class="bg-gray-50 rounded-lg p-4 text-center shadow-sm">
              <span class="text-xs font-semibold text-gray-600 uppercase block mb-1">
                Fecha de Solicitud
              </span>
              <span class="text-sm font-bold text-gray-800">
                {{ formatearFecha(solicitud.fecha_solicitud) }}
              </span>
            </div>

            <div class="bg-gray-50 rounded-lg p-4 text-center shadow-sm">
              <span class="text-xs font-semibold text-gray-600 uppercase block mb-1">
                Última Actualización
              </span>
              <span class="text-sm font-bold text-gray-800">
                {{ formatearFecha(solicitud.fecha_actualizacion) }}
              </span>
            </div>

            <div class="bg-gray-50 rounded-lg p-4 text-center shadow-sm">
              <span class="text-xs font-semibold text-gray-600 uppercase block mb-1">
                Fecha de Análisis
              </span>
              <span class="text-sm font-bold" [ngClass]="{
                  'text-gray-800': solicitud.fecha_analisis,
                  'text-gray-400 italic': !solicitud.fecha_analisis
                }">
                {{ solicitud.fecha_analisis ? formatearFecha(solicitud.fecha_analisis) : 'Pendiente' }}
              </span>
            </div>
          </div>
        </div>

      </div>
    </div>

  </div>
</div>


<!-- Vista del Formulario (cuando no hay solicitudes) -->
<div *ngIf="!cargando && !tieneSolicitudes" class="w-full px-4 py-10 mx-auto max-w-3xl">

  <div class="bg-white shadow-xl rounded-2xl p-8 border border-gray-200">

    <!-- Encabezado (simple, sin gradiente) -->
    <div class="mb-8">
      <h2 class="text-2xl font-bold text-gray-800 flex items-center gap-2">
        <i class="bi bi-file-earmark-plus text-cyan-600"></i>
        Nueva Solicitud de Préstamo
      </h2>
      <p class="text-gray-600 mt-1">Complete el formulario con la información requerida</p>
    </div>

    <form [formGroup]="solicitudForm" (ngSubmit)="onSubmit()" class="space-y-8">

      <!-- Campo: Monto Solicitado -->
      <div>
        <label for="monto_solicitado" class="text-sm font-semibold text-gray-700 flex justify-between">
          <span>Monto Solicitado <span class="text-red-600">*</span></span>
          <span class="text-cyan-600 font-bold">
            {{ solicitudForm.get('monto_solicitado')?.value | currency }}
          </span>
        </label>

        <div class="relative mt-2">
          <i class="bi bi-currency-dollar absolute left-3 top-3 text-gray-500"></i>

          <input type="number" id="monto_solicitado" formControlName="monto_solicitado" placeholder="0.00" step="0.01"
            min="0" class="w-full pl-10 pr-4 py-3 rounded-lg border text-gray-800 bg-gray-50 focus:bg-white
              focus:ring-2 focus:ring-cyan-500 transition-all
              [class.border-red-500]='monto_solicitado?.invalid && monto_solicitado?.touched'
              [class.border-green-500]='monto_solicitado?.valid && monto_solicitado?.touched'
            " />
        </div>

        <div class="mt-1 text-sm text-red-600" *ngIf="monto_solicitado?.invalid && monto_solicitado?.touched">
          <span *ngIf="monto_solicitado?.errors?.['required']">El monto es requerido</span>
          <span *ngIf="monto_solicitado?.errors?.['min']">Debe ser mayor a 0</span>
          <span *ngIf="monto_solicitado?.errors?.['pattern']">Ingrese un monto válido (ej: 1000.50)</span>
        </div>
      </div>

      <!-- Campo: Motivo del Préstamo -->
      <div>
        <label for="motivo_prestamo" class="text-sm font-semibold text-gray-700">
          Motivo del Préstamo <span class="text-red-600">*</span>
        </label>

        <textarea id="motivo_prestamo" formControlName="motivo_prestamo" rows="5"
          placeholder="Describa el motivo de su solicitud..." class="w-full mt-2 px-4 py-3 rounded-lg border text-gray-800 bg-gray-50 focus:bg-white
            focus:ring-2 focus:ring-cyan-500 transition-all resize-none
            [class.border-red-500]='motivo_prestamo?.invalid && motivo_prestamo?.touched'
            [class.border-green-500]='motivo_prestamo?.valid && motivo_prestamo?.touched'
          "></textarea>

        <div class="text-xs text-gray-500 mt-1" *ngIf="motivo_prestamo?.value">
          {{ motivo_prestamo?.value?.length || 0 }} / 500 caracteres
        </div>

        <div class="mt-1 text-sm text-red-600" *ngIf="motivo_prestamo?.invalid && motivo_prestamo?.touched">
          <span *ngIf="motivo_prestamo?.errors?.['required']">El motivo es requerido</span>
          <span *ngIf="motivo_prestamo?.errors?.['minlength']">Debe tener al menos 10 caracteres</span>
          <span *ngIf="motivo_prestamo?.errors?.['maxlength']">No puede exceder 500 caracteres</span>
        </div>
      </div>

      <!-- Campo: Plazo en Meses -->
      <div>
        <label for="plazo_meses" class="text-sm font-semibold text-gray-700">
          Plazo en MESES <span class="text-red-600">*</span>
        </label>

        <input type="number" id="plazo_meses" formControlName="plazo_meses" placeholder="Ej: 12" min="1" max="120"
          class="w-full mt-2 px-4 py-3 rounded-lg border text-gray-800 bg-gray-50 focus:bg-white
            focus:ring-2 focus:ring-cyan-500 transition-all
            [class.border-red-500]='plazo_meses?.invalid && plazo_meses?.touched'
            [class.border-green-500]='plazo_meses?.valid && plazo_meses?.touched'
          " />

        <div class="text-xs text-gray-500 mt-1">
          Mínimo: 1 mes | Máximo: 120 semanas (10 años)
        </div>

        <div class="mt-1 text-sm text-red-600" *ngIf="plazo_meses?.invalid && plazo_meses?.touched">
          <span *ngIf="plazo_meses?.errors?.['required']">El plazo es requerido</span>
          <span *ngIf="plazo_meses?.errors?.['min']">Debe ser al menos 1 mes</span>
          <span *ngIf="plazo_meses?.errors?.['max']">No puede exceder 120 semanas</span>
          <span *ngIf="plazo_meses?.errors?.['pattern']">Ingrese un número válido</span>
        </div>
      </div>

      <!-- Botones -->
      <div class="flex justify-end gap-3 pt-4 border-t border-gray-200">

        <!-- Botón Limpiar -->
        <button type="button"
          class="px-6 py-2 rounded-lg bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold transition disabled:opacity-50"
          (click)="resetForm()" [disabled]="!solicitudForm.dirty">
          <i class="bi bi-arrow-counterclockwise mr-1"></i>
          Limpiar
        </button>

        <!-- Botón Enviar -->
        <button type="submit"
          class="px-6 py-2 rounded-lg bg-cyan-600 hover:bg-cyan-700 text-white font-semibold shadow-md transition disabled:opacity-50"
          [disabled]="solicitudForm.invalid">
          <i class="bi bi-send-fill mr-1"></i>
          Enviar Solicitud
        </button>

      </div>

    </form>
  </div>
</div>

<!-- </div> -->
